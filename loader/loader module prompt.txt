"""
Prompt para Cursor: Crear un m贸dulo 'loader.py'
Funci贸n: Recolector central de datos para alimentar los m贸dulos anal铆ticos del sistema Optimatrading.

Este m贸dulo debe:
1. Recolectar datos de mercado en tiempo real y/o hist贸ricos desde m煤ltiples APIs.
2. Soportar m煤ltiples activos (empezando con el Top 10 por capitalizaci贸n de mercado en criptomonedas).
3. Permitir escalabilidad futura (m谩s activos, m谩s fuentes de datos).
4. Retornar los datos en una estructura estandarizada que pueda ser usada por los m贸dulos.
5. Validar y registrar errores si una API falla.

Librer铆as necesarias:
- `requests`
- `datetime`
- `pandas`
- `logging`

Estructura esperada:

# loader.py
- load_market_data(activo: str, intervalo: str = "1m", fuente: str = "binance") -> Dict
- get_top_assets() -> List[str]  # Cargar top 10 activos (o leer desde archivo)
- get_all_data_for_all_assets() -> Dict[str, Dict]  # Llama a load_market_data() por cada activo
- Clase LoaderManager: para centralizar el proceso y manejar errores

Las funciones deben permitir que los m贸dulos soliciten informaci贸n sin saber de d贸nde viene.

-----------------------------

#  API Keys (guardar en un archivo .env o config separado, pero para pruebas puedes dejarlo en loader):
API_KEYS = {
    "binance": "XmLESrJh1AbAlYOmypUCC9RJINw1HSQ6RXn5Tv5QJSKFjTulEt3udYDK6f25pdOE",
    "finnhub": "d0q0se1r01qmj4nhbvf0d0q0se1r01qmj4nhbvfg",
    "polygon": "u9sgnjo7UolwDyuaaO3MvG5ID2EoljrB",
    "twelve_data": "7b8c4b9f362343268e516d412eee55d0",
    "alphavantage": "5B7F2RFD6B09AWOU",
    "ninja_apis": "28b5lZ/fTAk2Pz+PW3VgiQ==Tg61OtIfiTYJP1aX"
}

#  Activos iniciales
TOP_ASSETS = ["BTCUSDT", "ETHUSDT", "USDTUSDT", "BNBUSDT", "SOLUSDT", "USDCUSDT", "XRPUSDT", "TONUSDT", "DOGEUSDT", "ADAUSDT"]

El m贸dulo debe funcionar como recolector de datos: lo que carga el loader se usa por los m贸dulos como base para hacer los an谩lisis.

Adem谩s, el prompt debe dejar el c贸digo preparado para permitir a帽adir nuevas APIs, activos o frecuencias sin afectar el resto del sistema.

Finalmente, debe contener funciones para guardar en cache (p. ej., localmente en archivo JSON o CSV) los datos en caso de error en la API.
"""


Crea el archivo `loader.py` para el sistema Optimatrading. Este archivo es responsable de recolectar y normalizar datos de mercado desde diferentes APIs para alimentar a los m贸dulos anal铆ticos.

Requisitos clave:

1. **Activos objetivo**:
   - Obt茅n datos de los 10 criptoactivos con mayor capitalizaci贸n de mercado actualmente (ej. BTC, ETH, BNB, SOL, XRP, ADA, DOGE, TON, TRX, LINK).
   - De momento, trabaja con BTCUSDT y ETHUSDT como ejemplo, pero el c贸digo debe estar listo para escalar f谩cilmente a los 10 activos.

2. **APIs disponibles**:
   - Binance (Spot y Futuros)
   - Finnhub
   - Polygon.io
   - Twelve Data
   - AlphaVantage
   - Ninja APIs

3. **Funciones esperadas**:
   - Recuperar:
     - Precio spot y de futuros.
     - Velas OHLC (1m, 5m, 15m).
     - Funding rate (si est谩 disponible).
     - Order book (profundidad, spread, volumen).
     - Volatilidad realizada e impl铆cita (si es posible).
     - Datos macroecon贸micos b谩sicos (si los permite alguna API).
   - Unificar los datos en un solo diccionario `normalized_data` con claves como:
     - `spot_price`
     - `futures_price`
     - `ohlcv_1m`, `ohlcv_5m`, etc.
     - `funding_rate`
     - `order_book`
     - `volatility_realized`
     - `volatility_implied`
     - `macro_data`

4. **Formato de salida**:
   - Exporta una funci贸n `load_data(active_symbol: str) -> dict` que reciba el s铆mbolo del activo (`BTCUSDT`, etc.) y devuelva un `dict` con todos los datos necesarios ya estructurados para el `dispatcher`.

5. **Gesti贸n de errores**:
   - Si una API falla, registra el error con `logging` y contin煤a con las dem谩s fuentes.
   - Si falta un dato, pon `None` o un valor por defecto seguro.

6. **Claves API**:
   - Asume que las API keys ya est谩n configuradas en un archivo llamado `optimatrading_config.py` o como variables de entorno. Usa una funci贸n como `get_api_key("binance")` para obtenerlas.
